{% comment %}
  Product Gallery Section - Display products in 2 column rows
{% endcomment %}

{% if section.settings.collection != blank %}
  {% assign selected_collection = collections[section.settings.collection] %}
{% else %}
  {% assign selected_collection = collections.all %}
{% endif %}

{% if selected_collection.products.size > 0 %}
  <div class="o-product-gallery-section">
    {% comment %} Title removed - no headline displayed {% endcomment %}
    
    <ul class="o-listing-grid o-listing-grid--2-columns" data-behavior="oListingGrid">
      {% assign product_count = selected_collection.products.size %}
      {% assign display_limit = section.settings.product_limit %}
      
      {% comment %} Find navy hoodie and display it first {% endcomment %}
      {% assign navy_hoodie = null %}
      {% for product in selected_collection.products %}
        {% assign product_title_lower = product.title | downcase %}
        {% if product_title_lower contains 'navy' and product_title_lower contains 'hoodie' %}
          {% assign navy_hoodie = product %}
          {% break %}
        {% endif %}
      {% endfor %}
      
      {% comment %} Show navy hoodie first if found {% endcomment %}
      {% if navy_hoodie != null %}
        {% render 'product-tile', product: navy_hoodie %}
      {% endif %}
      
      {% comment %} Show remaining products (excluding navy hoodie if already shown) {% endcomment %}
      {% assign products_shown = 0 %}
      {% if navy_hoodie != null %}
        {% assign products_shown = 1 %}
      {% endif %}
      {% for product in selected_collection.products %}
        {% if products_shown >= display_limit %}
          {% break %}
        {% endif %}
        {% assign product_title_lower = product.title | downcase %}
        {% unless product_title_lower contains 'navy' and product_title_lower contains 'hoodie' %}
          {% render 'product-tile', product: product %}
          {% assign products_shown = products_shown | plus: 1 %}
        {% endunless %}
      {% endfor %}
      
      {% comment %} Add 3 placeholder products if we have fewer products than the limit {% endcomment %}
      {% assign remaining_slots = display_limit | minus: product_count %}
      {% if remaining_slots > 0 %}
        {% assign placeholder_count = remaining_slots %}
        {% if placeholder_count > 3 %}
          {% assign placeholder_count = 3 %}
        {% endif %}
        {% for i in (1..placeholder_count) %}
          {% render 'product-tile-placeholder' %}
        {% endfor %}
      {% endif %}
    </ul>
  </div>
{% else %}
  {% comment %} Fallback if no products - show 3 placeholders {% endcomment %}
  <div class="o-product-gallery-section">
    {% comment %} Title removed - no headline displayed {% endcomment %}
    
    <ul class="o-listing-grid o-listing-grid--2-columns" data-behavior="oListingGrid">
      {% for i in (1..3) %}
        {% render 'product-tile-placeholder' %}
      {% endfor %}
    </ul>
  </div>
{% endif %}

{% schema %}
{
  "name": "Product Gallery",
  "settings": [
    {
      "type": "text",
      "id": "title",
      "label": "Section Title",
      "default": "Featured Products"
    },
    {
      "type": "collection",
      "id": "collection",
      "label": "Collection",
      "info": "Select a collection to display products from. Leave empty to show all products."
    },
    {
      "type": "range",
      "id": "product_limit",
      "label": "Number of products to show",
      "min": 4,
      "max": 24,
      "step": 2,
      "default": 8
    }
  ],
  "presets": [
    {
      "name": "Product Gallery"
    }
  ]
}
{% endschema %}
